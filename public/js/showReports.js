// Generated by CoffeeScript 1.6.1
(function() {
  var confirm, deleteReport;

  getReports();

  getReportNum();

  confirm = function(reportId) {
    return $("#dialog-confirm").dialog({
      dialogClass: "no-close",
      resizable: false,
      height: 560,
	  width: 800,
      modal: true,
      buttons: {
        "Delete": function() {
          deleteReport(reportId);
          return $(this).dialog("close");
        },
        Cancel: function() {
          return $(this).dialog("close");
        }
      }
    });
  };

  $("#reportList").on("click", "p.delete", function() {
    var dateStr,reportId,content;
	dateStr = $(this).attr("dateStr");
    reportId = $(this).attr("reportId");
	content = $(this).attr("content");
	console.log('Get dateStr:' + dateStr);
    console.log('Get reportId:' + reportId);
	console.log('Get content:' + content);
	
	data = {
        date: dateStr,
		reportId: reportId,
        content: content
    };
	
	return ReportModel.editReport(data, function(response) {
		window.location.href = "/write";
		return callback(response);
	
	});
	//return window.location.href = "/write";
	// post and route to a new sub, render the write page and the data
	//return $.post("/edit", data, function(response) {
    //    return callback(response);
    //  }, "json");
	  
	  
	  
	window.location.href='/write?reportId=' + reportId + '&content=' + content;
	
	return confirm(reportId);
  });

  deleteReport = function(reportId) {
    return ReportModel.deleteReport({
      reportId: reportId
    }, function(response) {
      var page;
      if (response.state === 0) {
        return;
      }
      reportvm.reportNum(reportvm.reportNum() - 1);
      page = reportvm.currentPage();
      if (reportvm.reports().length === 1 && reportvm.currentPage() > 1) {
        page = reportvm.currentPage() - 1;
      }
      return gotoPage(page);
    });
  };

}).call(this);
